<!doctype html><html lang=en-US><head><meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://blog.thibaud.io/images/favicon.png><title>State Machines for Attacks | rheneross</title>
<meta name=title content="State Machines for Attacks"><meta name=description content="I&rsquo;m currently implementing super attacks for my autobattler rogue like set in space.
The goal is to have each turrets being able to perform unique super attacks on certain conditions.
I started with a simple MonoBehavior attached to the turret.
Then when I wanted to create a second super attack, I had to duplicate a bunch of the code. So I factored what I could in a parent class.
I couldn&rsquo;t implement the 3rd attack with the previous design, so I ended up deleting most of it and implementing a simple State Machine, with 2 states."><meta name=author content><meta name=keywords content><meta property="og:url" content="https://blog.thibaud.io/posts/archives/devlog-1-fsm-for-attacks/"><meta property="og:site_name" content="rheneross"><meta property="og:title" content="State Machines for Attacks"><meta property="og:description" content="I’m currently implementing super attacks for my autobattler rogue like set in space.
The goal is to have each turrets being able to perform unique super attacks on certain conditions.
I started with a simple MonoBehavior attached to the turret. Then when I wanted to create a second super attack, I had to duplicate a bunch of the code. So I factored what I could in a parent class.
I couldn’t implement the 3rd attack with the previous design, so I ended up deleting most of it and implementing a simple State Machine, with 2 states."><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-07-31T22:00:49+02:00"><meta property="article:modified_time" content="2022-07-31T22:00:49+02:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="State Machines for Attacks"><meta name=twitter:description content="I’m currently implementing super attacks for my autobattler rogue like set in space.
The goal is to have each turrets being able to perform unique super attacks on certain conditions.
I started with a simple MonoBehavior attached to the turret. Then when I wanted to create a second super attack, I had to duplicate a bunch of the code. So I factored what I could in a parent class.
I couldn’t implement the 3rd attack with the previous design, so I ended up deleting most of it and implementing a simple State Machine, with 2 states."><meta itemprop=name content="State Machines for Attacks"><meta itemprop=description content="I’m currently implementing super attacks for my autobattler rogue like set in space.
The goal is to have each turrets being able to perform unique super attacks on certain conditions.
I started with a simple MonoBehavior attached to the turret. Then when I wanted to create a second super attack, I had to duplicate a bunch of the code. So I factored what I could in a parent class.
I couldn’t implement the 3rd attack with the previous design, so I ended up deleting most of it and implementing a simple State Machine, with 2 states."><meta itemprop=datePublished content="2022-07-31T22:00:49+02:00"><meta itemprop=dateModified content="2022-07-31T22:00:49+02:00"><meta itemprop=wordCount content="331"><meta name=referrer content="no-referrer-when-downgrade"><link href=/original.min.css rel=stylesheet><link href=/syntax.min.css rel=stylesheet></head><body><header><a class=skip-link href=#main-content>Skip to main content</a><nav><a href=/>home</a>
<a href=/posts/>posts</a></nav></header><main id=main-content><h1>State Machines for Attacks</h1><content><p>I&rsquo;m currently implementing super attacks for my autobattler rogue like set in space.<br>The goal is to have each turrets being able to perform unique super attacks on certain conditions.</p><p>I started with a simple MonoBehavior attached to the turret.
Then when I wanted to create a second super attack, I had to duplicate a bunch of the code. So I factored what I could in a parent class.</p><p>I couldn&rsquo;t implement the 3rd attack with the previous design, so I ended up deleting most of it and implementing a simple State Machine, with 2 states.</p><p>The 1st state is the IdleState, it&rsquo;s only job is to check if the condition needed to activate the special attack is met:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>abstract</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Super</span> : MonoBehaviour
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> StateMachine stateMachine;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> State superIdleState;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> State superPerformState;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> Awake()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        stateMachine = <span style=color:#66d9ef>new</span> StateMachine();
</span></span><span style=display:flex><span>        superIdleState = <span style=color:#66d9ef>new</span> State(<span style=color:#e6db74>&#34;SuperIdleState&#34;</span>, updateHandler: UpdateStateIdleState);
</span></span><span style=display:flex><span>        <span style=color:#75715e>// ...</span>
</span></span><span style=display:flex><span>        stateMachine.ChangeState(superIdleState);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> UpdateStateIdleState()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span>(CanSuperBePerformed()) stateMachine.ChangeState(superPerformState);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> Update()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        stateMachine.Update();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Check function MUST be implemented</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>abstract</span> <span style=color:#66d9ef>bool</span> CanSuperBePerformed();
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>The 2nd state gives us the tool to implement the special attack it self:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>abstract</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Super</span> : MonoBehaviour
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>float</span> EffectDuration = <span style=color:#ae81ff>0.5f</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>float</span> currentEffectDuration = <span style=color:#ae81ff>0.0f</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> Awake()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        stateMachine = <span style=color:#66d9ef>new</span> StateMachine();
</span></span><span style=display:flex><span>        superIdleState = <span style=color:#66d9ef>new</span> State(<span style=color:#e6db74>&#34;SuperIdleState&#34;</span>, updateHandler: UpdateStateIdleState);
</span></span><span style=display:flex><span>        superPerformState = <span style=color:#66d9ef>new</span> State( <span style=color:#e6db74>&#34;SuperPerformState&#34;</span>, enterHandler: OnEnterPerformState, updateHandler: OnUpdatePerformState, exitHandler: OnExitPerformState);
</span></span><span style=display:flex><span>        stateMachine.ChangeState(superIdleState);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> OnEnterPerformState()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        currentEffectDuration = EffectDuration;
</span></span><span style=display:flex><span>        EnableEffect();
</span></span><span style=display:flex><span>        PerformEffectOnceAtStart();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> OnUpdatePerformState()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        currentEffectDuration -= Time.deltaTime;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span>(EffectDuration != -<span style=color:#ae81ff>1</span> &amp;&amp; currentEffectDuration &lt;= <span style=color:#ae81ff>0.0f</span>) {
</span></span><span style=display:flex><span>            PerformEffectOnceAtEnd();
</span></span><span style=display:flex><span>            stateMachine.ChangeState(superIdleState);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        PerformEffectTick();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> OnExitPerformState()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        DisableEffect();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>virtual</span> <span style=color:#66d9ef>void</span> PerformEffectOnceAtStart() {}
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>virtual</span> <span style=color:#66d9ef>void</span> PerformEffectOnceAtEnd() {}
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>virtual</span> <span style=color:#66d9ef>void</span> PerformEffectTick() {}
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>virtual</span> <span style=color:#66d9ef>void</span> EnableEffect() {}
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>virtual</span> <span style=color:#66d9ef>void</span> DisableEffect() {}
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>This system gives us a lot of flexibility to create new super attack.<br>I&rsquo;m sure it will evolve again in the future so <a href=https://www.getrevue.co/profile/thibaudio>subscribe to the newsletter</a> if you want to follow along!</p></content><p></p></main><footer><small><a href=https://blog.thibaud.io/index.xml>RSS</a> | <a href=https://bsky.app/profile/rheneross.com>bluesky</a> | Made with <a href=https://github.com/clente/hugo-bearcub>Bear Cub</a></small></footer></body></html>